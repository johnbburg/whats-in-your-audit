<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>What's in your Audit</title>

		<meta name="description" content="A guide to auditing Drupal sites">
		<meta name="author" content="John Brandenburg">
        <link href="/images/favicon.png" rel="shortcut icon">


        <meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/f1.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section class="title-slide" data-background="#ef4836">
					<h1>What's in your Audit?</h1>
					<h3>A Guide to Auditing Drupal websites.</h3>
					<p>
						<small>July 21, 2015, Drupal GovCon</small>

					</p>
                    <p>
                        <small>@johnbburg, #whatsinyouraudit</small>
                    </p>

                    <aside class="notes">
                        <p>intro.</p>
                        <p>twitter.</p>
                        <p>inclusive to all skill levels. some tech speak.</p>
                        <p>Apply this to building sites as well.</p>
                        <p>Not focused on D8, but ideas can apply.</p>
                        <p>So who am I?</p>
                    </aside>

				</section>

                <section class="introduction">
                    <h3>Nice to Meet You!</h3>
                    <img src="images/featured-tweet.png">
                    <p>John Brandenburg, Senior Developer, Forum One</p>
                    <aside class="notes">you may remember me from such Drupal Association Newsletter Featured Tweets, as last week's
                        <p>Promote DA</p>
                    </aside>
                </section>

                <section class="full-bleed" data-background="images/johnsnow.png">
                    <aside class="notes">
                        <p>...And I'm on the support team.</p>
                        <p>I've seen a lot of different Drupal sites and different approaches.</p>
                        <p>Occasionally, I am asked to conduct an audit prior to taking over support.</p>
                    </aside>
                </section>


                <section>
                    <section class="subsection-divider" data-background="#7CCFD9">
                        <h1>Why Audit?</h1>
                    </section>

                    <section>
                        <h1>Catalog Technical Debt</h1>
                        <p>Coined by Ward Cunningham</p>
                        <aside class="notes">
                        </aside>

                    </section>

                    <section class="introduction">
                        <iframe width="640" height="480" src="https://www.youtube.com/embed/pqeJFYwnkjE" frameborder="0" allowfullscreen></iframe>
                        <p><a href="http://c2.com/cgi/wiki?WardExplainsDebtMetaphor">http://c2.com/cgi/wiki?WardExplainsDebtMetaphor</a></p>
                        <p><a href="http://c2.com/doc/oopsla92.html">http://c2.com/doc/oopsla92.html</a></p>
                        <aside class="notes">
                        </aside>
                    </section>

                    <section>
                        <img src="images/tech-debt.jpg" />
                        <p><a href="http://blog.ifsworld.com/2012/03/no-thanks-im-too-busy-to-listen-to-you/">ifsworld.com</a></p>
                        <aside class="notes">
                            <ul>
                            <li>We get caught up in work and don't pay down the debt.</li>
                            <li>Often don't have the vision that we are in debt.</li>
                            <li>Hard convince a product owner.</li>
                            <li>Auditing the the first place is the right step.</li>
                            </ul>
                        </aside>
                    </section>

                    <section>
                        <img src="images/the_general_problem.png" />
                        <p><a href="http://xkcd.com/974/">xkcd</a></p>
                        <p><a href="http://idlewords.com/talks/web_design_first_100_years.htm">We don't need to "Fix the world with software."</a></p>
                        <aside class="notes">
                            <p>On the flip side. carried away</p>
                            <p>"good enough"</p>
                        </aside>
                    </section>

                </section>

                <section>
                    <h2> Didn't want to just Go through a list of best practices.</h2>
                </section>

                <section>
                    <h1> But here it is.</h1>
                    <aside class="notes">
                        A few warnings:
                        <ul>
                            <li>Subject to opinion.</li>
                            <li>Your mileage may vary</li>
                            <li>What I learned in my career in Drupal</li>
                            <li>Let's talk afterwards: twitter.</li>
                        </ul>
                    </aside>
                </section>


                <section>
                    <section class="subsection-divider" data-background="#7CCFD9">
                        <a href="https://docs.google.com/spreadsheets/d/14RsCyyhmdzIUOb7EiWOiknuyNM_7lMRg52nWkFM9qPo/edit">
                            <h2>The Checklist</h2>
                            <img src="images/checklist-preview.png" />
                        </a>
                        <aside class="notes">
                            I'll be tweeting links.
                        </aside>
                    </section>

                    <section>
                        <h3>How to use this document.</h3>
                        <ul>
                            <li>Assess: Build a mental model.</li>
                            <li>Action: Make a recommendation.</li>
                            <li>Estimate: Cost to fix.</li>
                        </ul>
                        <aside class="notes">
                            <ul>
                                <li>Often the action is just to document something.</li>
                                <li>Remember that estimates are just estimates.</li>
                            </ul>
                        </aside>
                    </section>

                    <section>
                        <h2>What you will need</h2>
                        <ul>
                            <li>Access to code</li>
                            <li>Copy of database</li>
                            <li>Admin accounts</li>
                            <li>Shell/remote access to production/staging environment</li>
                        </ul>

                        <p>Stand up a copy of the site.</p>
                        <p>Review status of site on host. Reports > Status Report</p>
                        <aside class="notes">
                            <p>Can be done without admin access, but will be incomplete.</p>
                        </aside>
                    </section>

                </section>


                <section>

                    <section class="subsection-divider" data-background="#7CCFD9">
                        <h2>General Best Practices</h2>
                    </section>


                    <section>
                        <h2>Quick Checks</h2>
                        <p>Prod Check <a href="https://www.drupal.org/project/prod_check">https://www.drupal.org/project/prod_check</a> </p>
                        <p>(admin ui that expands on status report)</p>
                        <p>Site Audit: <a href="https://www.drupal.org/project/site_audit">https://www.drupal.org/project/site_audit</a> </p>
                        <p>(drush commands generate reports)</p>
                        <aside class="notes">
                            Show other tabs.
                        </aside>
                    </section>

                    <section>
                        <h1>Hacked!</h1>
                        <p>
                            The Drupal Patching Ecosystem
                        </p>
                        <img src="images/hacked.drupal.png"/>
                        <aside class="notes">
                            <p>Patching modules is extremely common.</p>
                            <p>Secure Pages requires a patch to core.</p>
                            <p>A patched module is harder to update.</p>
                        </aside>

                    </section>

                    <section>
                        <h2>There is a process</h2>
                        <p>
                            The point is to document these modifications. And share!
                        </p>
                        <pre>
drupalroot/
patches/
  project/[project]-[description]-[issue]-[comment]-[core-version].patch
                        </pre>
                        <p><a href="https://www.drupal.org/patch/submit">https://www.drupal.org/patch/submit</a></p>
                        <p>And there should be an issue filed in the project's queue. Even if it just supports your use case!</p>
                    </section>

                    <section>
                        <p>
                            Any custom code follows Drupal coding standards (<a href="https://www.drupal.org/coding-standards">https://www.drupal.org/coding-standards</a>).

                        </p>
                        <p>
                            You don't need to memorize these! <a href="https://www.drupal.org/project/coder">https://www.drupal.org/project/coder</a>
                        </p>
                    </section>

                    <section>
                        <h1>
                            Use the API
                        </h1>
                        Views Example:
                            <pre><code data-trim class="php">

$view->display['default']->handler->options['filters']['changed']['value'] = '2025-04-30 00:00:00';

                            </code></pre>

                        <p>Vs.</p>


                            <pre><code data-trim class="php">
$filters = array();
$filters['changed'] = '2025-04-30 00:00:00';

$view->set_exposed_input($filters);
                            </code></pre>
                    </section>
                    <section>
                        <h2>Documentation</h2>
                        <p>
                            It exists, is correct, and ideally, focuses on the <strong>why</strong>, over the how.
                        </p>
                        <pre><code data-trim class="js">
// When the number of items exceeds the visible items,
// resetting the width will collapse the size to
// the viewport width and cause all items be in view.
if ( numItems >= visibleItems ) {
    return;
}
                        </code></pre>
                    </section>

                    <section>
                        <h2>Other tidbits</h2>
                        <ul>
                            <li>Use of $_SESSION for anon users.</li>
                            <li>Heavy use of includes (dozens).</li>
                            <li>Is version control in use?</li>
                            <li>Location of webroot in VCS (exception: Pantheon)</li>
                        </ul>
                        <aside class="notes">
                            This is the random of the random.
                        </aside>

                    </section>

                </section>


                <section>
                    <section  class="subsection-divider" data-background="#7CCFD9">
                        <h1>Modules</h1>
                    </section>
                    <section>
                        Update status
                    </section>
                    <section>
                        Maintenance status
                    </section>
                    <section>
                        Release version
                        <aside class="notes">You have my sympathies of you used an unstable release of media - just went into beta the other week.</aside>
                    </section>
                </section>


                <section>
                    <section class="subsection-divider" data-background="#7CCFD9">
                        <h2>Site Configuration / Architecture</h2>
                    </section>
                    <section>
                        <p>How were pages engineered? Was the approach done in a best practices manner?</p>
                        <p>Blocks &lt; Context &lt; Panels</p>
                        <aside class="notes">
                            <ul>
                                <li>Block system rendered, then placed.</li>
                                <li>Block and context gives you tunnel vision.</li>
                            </ul>
                        </aside>
                    </section>
                    <section>
                        <p>Is configuration tracked?</p>
                        <p>Exported to Features/Config Management.</p>
                    </section>
                    <section>
                        <p>Are exported features cohesive? They should be restricted one feature per bundle type, not one single, site-wide feature.</p>
                        <aside class="notes">Very large features can run into memory/performance problems.</aside>
                    </section>
                    <section class="subsection-divider" data-background="#7CCFD9">
                        <h2>File system</h2>
                    </section>
                    <section>
                        </p>Make sure all files are not stored in the same directory (single directories with a lot of files can slow down a system). File fields should use a token to group it's directories, for example:</p>

<pre><code data-trim>
    images/field-name/[year]/[month]
</code></pre>
                        <aside class="notes">Also simply for human comprehension.</aside>
                    </section>
                    <section>
                        </P>Sensitive files are placed in a private location.</p>
                        <aside class="notes">Resumes anyone?</aside>
                    </section>
                </section>


                <section>
                    <section class="subsection-divider" data-background="#7CCFD9">
                        <h1>Security Review</h1>
                        <p>This spans site code/config and the hosting environment.</p>
                    </section>
                    <section>
                        <p>Modules are up to date with security releases.</p>
                        <p><a href="https://www.drupal.org/security-team/risk-levels">Risk levels defined</a></p>
                        <aside class="notes">
                            Determine risk level. Might be decided for you by PCI or FISMA.
                        </aside>
                    </section>
                    <section>
                        <p>No “PHP fields/Input modes” are used on the site.</p>
                        <p>This isn't just a security issue. Try indexing solr with a drupal_goto().</p>
                        <aside class="notes">PHP makes rendering a node behave in unexpected ways</aside>
                    </section>
                    <section>
                        <p>High access input formats are only granted to appropriately vetted users (e.g. full html should be restricted to trusted roles).</p>
                    </section>
                    <section>
                        <p>Anti-spam technology is required for any open user registration.</p>
                        <ul>
                            <li>Captcha</li>
                            <li>Honeypot</li>
                            <li>Mollom</li>
                            <li>Community manager</li>
                        </ul>
                        <aside class="notes">
                            <ul>
                                <li>I've seen databases 90% composed of user spam.</li>
                                <li>Some legitimate, well-intentioned users just aren't going to provide high quality content.</li>
                            </ul>
                        </aside>
                    </section>
                    <section>
                        <p>The hosting environment is up to date.</p>
                        <p>Hosting Vs. Managed Hosting.</p>
                        <aside class="notes">
                            <ul>
                                <li>Big diff between hosting and managed.</li>
                                <li>F1 patched ~60 servers against the bash-shock vulnerability within hours.</li>
                            </ul>
                        </aside>
                    </section>
                    <section>
                        <p>Any development or staging instances of the site are hidden from unauthorized access/search indexing.</p>
                        <aside class="notes">Once saw an abandoned dev instance cause the server to be hacked due to un-patched ckeditor</aside>
                    </section>
                    <section>
                        <p>Any unused user ssh or (s)ftp user accounts are discontinued.</p>
                        <aside class="notes">Not just social engineering, but careless/former staff is an issue.</aside>
                    </section>
                    <!-- <section>
                        <p>Individual users are assigned unique user accounts, No single user profile should be shared with all users. Also, root user should never be directly used.</p>
                        <aside class="notes">Honestly, Drupal doesn't keep an audit trail of config changes not in VCS. Maybe a good module idea.</aside>
                    </section> -->
                    <section>
                        <p>ssh uses public/private key authentication instead of passwords. At least 2048 bits.</p>
                    </section>
                    <section>
                        <p>General web-server best practices:</p>
                        <p><a href="http://wiki.nginx.org/Drupal">Nginx</a></p>
                        <p><a href="http://nadeausoftware.com/articles/2009/05/drupal_and_apache_web_site_security_checklist_part_1">Apache</a></p>
                        <aside class="notes">Tons of options here, the links provide some good sources.</aside>
                    </section>
                </section>

                <section>

                    <section class="subsection-divider" data-background="#7CCFD9">
                        <h2>Hosting Environment</h2>
                    </section>

                    <section>
                        <p>What is the current update status of software packages? (php, mysql, apache). Note PHP 5.3.3 on RHEL 6 systems is vendor supported.</p>
                    </section>

                    <section>
                        <p>php memory limits (We normally use 192MB)</p>
                        <aside class="notes">
                            <p>This will vary, anything 512 and over would be an indicator of problems in the way the site was engineered.</p>
                            <p>F1 client ~12 gigs.</p>
                        </aside>
                    </section>

                    <section>
                        <p>If APC is used shm size (~96MB - 128MB)</p>
                        <p>APC is not a very good general back-end cache for Drupal. Poor fragmentation hits performance.</p>
                        <aside class="notes">
                            <p>Size wil vary. Default is never adequate (64MB).</p>
                            <p>More if APC is back end.</p>
                            <p>Don't use it as a back end. Especially for page cache.</p>
                        </aside>
                    </section>

                </section>

                <section>
                    <section class="subsection-divider" data-background="#7CCFD9">
                        <h1>Front End</h1>
                    </section>
                    <section>
                        <p>CSS well architected. Avoid duct tape themes.</p>
                    </section>
                    <section>
                        <p>Overuse of templates?</p>
                        <p>Display Suite!</p>
                    </section>
                    <section>
                        <p>Business logic in theme layer?</p>
                        <p>The only if statements should be checking that a variable is set or not empty.</p>
                    </section>
                </section>

                <section>

                    <section class="subsection-divider" data-background="#7CCFD9">
                        <h1>Process</h1>
                    </section>

                    <section>
                        <p>Deliverable requirements. What does the client expect from your support?</p>
                        <aside>Just patching? Strategy? Performing deployments?</aside>
                    </section>

                    <section>
                        How will releases be delivered?
                        <aside class="notes">
                            <p>As a subcontractor, may not know. But should learn what steps are being taken.</p>
                            <p>One site I know of, they were just unzipping over the existing installation. Which did not delete/move files.</p>
                        </aside>
                    </section>

                    <section>
                        Deployment requirements
                    </section>

                </section>


                <section>
                    <section class="subsection-divider" data-background="#7CCFD9">
                        <h2>Opportunities</h2>
                        <p>General opportunities for improvements</p>
                        <p>Upsell your services!</p>
                    </section>
                    <section>
                        <ul>
                            <li>Analytics</li>
                            <li>UX/Design</li>
                            <li>Solr Search</li>
                        </ul>
                    </section>
                </section>

                <section class="title-slide" data-background="#ef4836">
                    <h1>Thank You!!!</h1>
                    <aside class="notes">Mention F1 services.</aside>
                </section>


            </div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
